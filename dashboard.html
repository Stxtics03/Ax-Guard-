<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AxGuard Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to right, #f0f4f8, #d9e2ec);
      margin: 0;
      padding: 20px;
      color: #333;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
    }
    .container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }
    .card {
      background: rgba(255, 255, 255, 0.8);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .card h2 {
      font-size: 1.2rem;
      margin-bottom: 10px;
    }
    .status {
      font-size: 0.9rem;
      margin-top: 8px;
    }
    #toggleBtn {
      display: block;
      margin: 20px auto;
      background-color: #2563eb;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
    }
    #toggleBtn:hover {
      background-color: #1e40af;
    }
    .clickable {
      cursor: pointer;
      transition: transform 0.3s ease-in-out;
    }
    .clickable:hover {
      transform: scale(1.05);
    }
    #modalOverlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    #modalContent {
      background: white;
      border-radius: 12px;
      padding: 20px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 6px 12px rgba(0,0,0,0.2);
      position: relative;
    }
    #modalContent h3 {
      margin-top: 0;
    }
    #modalCloseBtn {
      position: absolute;
      top: 12px;
      right: 12px;
      background: transparent;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>AxGuard Dashboard</h1>
  <button id="toggleBtn" onclick="toggleDataMode()">Show Unsafe Data</button>

  <div class="container">
    <!-- All cards clickable with hover animation -->
    <div onclick="openModal('ph')" class="card clickable">
      <h2>pH Level: <span id="phValue"></span></h2>
      <canvas id="phChart" height="100"></canvas>
      <div class="status" id="phStatus"></div>
    </div>

    <div onclick="openModal('tds')" class="card clickable">
      <h2>TDS: <span id="tdsValue"></span></h2>
      <canvas id="tdsChart" height="100"></canvas>
      <div class="status" id="tdsStatus"></div>
    </div>

    <div onclick="openModal('turbidity')" class="card clickable">
      <h2>Turbidity: <span id="turbValue"></span></h2>
      <canvas id="turbChart" height="100"></canvas>
      <div class="status" id="turbStatus"></div>
    </div>

    <div onclick="openModal('temperature')" class="card clickable">
      <h2>Temperature: <span id="tempValue"></span></h2>
      <canvas id="tempChart" height="100"></canvas>
      <div class="status" id="tempStatus"></div>
    </div>

    <div onclick="openModal('level')" class="card clickable">
      <h2>Tank Level: <span id="levelValue"></span></h2>
      <canvas id="levelChart" height="100"></canvas>
      <div class="status" id="levelStatus"></div>
    </div>
  </div>

  <div id="modalOverlay">
    <div id="modalContent">
      <button id="modalCloseBtn" onclick="closeModal()">✖</button>
      <h3 id="modalTitle"></h3>
      <p id="modalBody">Loading...</p>
    </div>
  </div>

  <script>
    const chartInstances = {};
    let currentMode = 'safe';

    const safeData = {
      ph: 6.8,
      tds: 230,
      turbidity: 15,
      temperature: 26,
      level: 76
    };

    const unsafeData = {
      ph: 5.2,
      tds: 780,
      turbidity: 28,
      temperature: 34,
      level: 12
    };

    // Add event listener for Escape key
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        closeModal();
      }
    });

    function toggleDataMode() {
      currentMode = currentMode === 'safe' ? 'unsafe' : 'safe';
      renderData(currentMode === 'safe' ? safeData : unsafeData);
      document.getElementById('toggleBtn').innerText =
        currentMode === 'safe' ? 'Show Unsafe Data' : 'Show Safe Data';
    }

    function renderData(data) {
      document.getElementById('phValue').innerText = data.ph.toFixed(1);
      document.getElementById('phStatus').innerText =
        data.ph >= 6.5 && data.ph <= 8.5 ? '✅ Safe' : '⚠️ Unsafe';

      document.getElementById('tdsValue').innerText = data.tds + ' ppm';
      document.getElementById('tdsStatus').innerText =
        data.tds <= 500 ? '✅ Safe' : '⚠️ High';

      document.getElementById('turbValue').innerText = data.turbidity + ' NTU';
      document.getElementById('turbStatus').innerText =
        data.turbidity <= 5 ? '✅ Clear' : '⚠️ Cloudy';

      document.getElementById('tempValue').innerText = data.temperature + ' °C';
      document.getElementById('tempStatus').innerText =
        data.temperature <= 30 ? '✅ Normal' : '⚠️ Hot';

      document.getElementById('levelValue').innerText = data.level + '%';
      document.getElementById('levelStatus').innerText =
        data.level >= 90 ? '⚠️ Overflow Risk' :
        data.level <= 20 ? '⚠️ Low' : '✅ OK';

      updateChart('phChart', 'pH Level', [7.2, data.ph], 'rgba(0, 123, 255, 0.8)', 'rgba(0, 123, 255, 0.2)');
      updateChart('tdsChart', 'TDS', [220, data.tds], 'rgba(40, 167, 69, 0.8)', 'rgba(40, 167, 69, 0.2)');
      updateChart('turbChart', 'Turbidity', [10, data.turbidity], 'rgba(102, 16, 242, 0.8)', 'rgba(102, 16, 242, 0.2)');
      updateChart('tempChart', 'Temperature', [25, data.temperature], 'rgba(255, 159, 64, 0.8)', 'rgba(255, 159, 64, 0.2)');
      updateChart('levelChart', 'Tank Level (%)', [65, data.level], 'rgba(0, 128, 128, 0.8)', 'rgba(0, 128, 128, 0.2)');
    }

    function updateChart(canvasId, label, dataPoints, borderColor, fillColor) {
      const ctx = document.getElementById(canvasId).getContext('2d');

      if (chartInstances[canvasId]) {
        chartInstances[canvasId].destroy();
      }

      chartInstances[canvasId] = new Chart(ctx, {
        type: 'line',
        data: {
          labels: ['1h ago', 'Now'],
          datasets: [{
            label: label,
            data: dataPoints,
            borderColor: borderColor,
            backgroundColor: fillColor,
            fill: true,
            tension: 0.3,
            pointRadius: 4,
            pointBackgroundColor: borderColor
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: false } }
        }
      });
    }

    function openModal(type) {
      const overlay = document.getElementById('modalOverlay');
      const title = document.getElementById('modalTitle');
      const body = document.getElementById('modalBody');

      switch(type) {
        case 'ph':
          title.innerText = 'pH Level Details';
          body.innerHTML = `
            <p>The pH level indicates how acidic or basic the water is.</p>
            <ul>
              <li>Safe range: 6.5 - 8.5</li>
              <li>Current value: <strong>${document.getElementById('phValue').innerText}</strong></li>
              <li>Status: ${document.getElementById('phStatus').innerText}</li>
            </ul>
          `;
          break;
        case 'tds':
          title.innerText = 'Total Dissolved Solids (TDS) Details';
          body.innerHTML = `
            <p>TDS indicates the concentration of dissolved solids in water.</p>
            <ul>
              <li>Safe limit: ≤ 500 ppm</li>
              <li>Current value: <strong>${document.getElementById('tdsValue').innerText}</strong></li>
              <li>Status: ${document.getElementById('tdsStatus').innerText}</li>
            </ul>
          `;
          break;
        case 'turbidity':
          title.innerText = 'Turbidity Details';
          body.innerHTML = `
            <p>Turbidity measures water clarity by detecting suspended particles.</p>
            <ul>
              <li>Safe limit: ≤ 5 NTU</li>
              <li>Current value: <strong>${document.getElementById('turbValue').innerText}</strong></li>
              <li>Status: ${document.getElementById('turbStatus').innerText}</li>
            </ul>
          `;
          break;
        case 'temperature':
          title.innerText = 'Temperature Details';
          body.innerHTML = `
            <p>Water temperature affects chemical and biological processes.</p>
            <ul>
              <li>Safe limit: ≤ 30°C</li>
              <li>Current value: <strong>${document.getElementById('tempValue').innerText}</strong></li>
              <li>Status: ${document.getElementById('tempStatus').innerText}</li>
            </ul>
          `;
          break;
        case 'level':
          title.innerText = 'Tank Level Details';
          body.innerHTML = `
            <p>Tank level indicates the current water volume in the system.</p>
            <ul>
              <li>Optimal range: 20-90%</li>
              <li>Current value: <strong>${document.getElementById('levelValue').innerText}</strong></li>
              <li>Status: ${document.getElementById('levelStatus').innerText}</li>
            </ul>
          `;
          break;
      }

      overlay.style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('modalOverlay').style.display = 'none';
    }

    // Initialize with safe data
    renderData(safeData);
  </script>
</body>
</html>
